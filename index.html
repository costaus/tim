<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIM Atendimento - Vendas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .chat-bg {
            background-image: url('https://iili.io/FWtwY0J.jpg');
            background-position: center;
            background-size: cover;
        }
        #chat-messages::-webkit-scrollbar { width: 6px; }
        #chat-messages::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        #chat-messages::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.3); border-radius: 3px; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-fade-in { animation: fadeIn 0.3s ease-out; }

        .message-bubble::after {
            content: "";
            position: absolute;
            top: 0;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }
        .message-sent::after { right: -10px; border-left-color: #dcf8c6; }
        .message-received::after { left: -10px; border-right-color: #ffffff; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    </style>
</head>
<body class="bg-gray-200">

    <div id="chatbot-container" class="w-screen h-screen flex flex-col bg-gray-100">
        <!-- Cabe√ßalho do Chat -->
        <header class="flex items-center p-3 bg-[#005C9E] text-white shadow-md z-10 flex-shrink-0">
            <img src="https://iili.io/FWLZI87.jpg" alt="Logo TIM" class="w-12 h-12 rounded-full mr-4 border-2 border-white">
            <div>
                <h1 class="text-lg font-semibold">TIM Vendas</h1>
                <p class="text-sm text-gray-200">online</p>
            </div>
        </header>

        <!-- √Årea de Mensagens -->
        <main id="chat-messages" class="flex-1 overflow-y-auto p-4 sm:p-6 chat-bg flex flex-col space-y-4">
            <!-- Mensagens inseridas via JavaScript -->
        </main>

        <!-- √Årea de Sugest√µes/Bot√µes R√°pidos -->
        <div id="quick-replies" class="p-2 flex flex-wrap justify-center gap-2 bg-gray-100 border-t border-gray-200 transition-all duration-300">
            <!-- Bot√µes de resposta r√°pida inseridos aqui -->
        </div>

        <!-- Rodap√© com Input de Mensagem -->
        <footer class="p-3 bg-gray-100 flex items-center border-t border-gray-200 flex-shrink-0">
            <div class="flex-1">
                <form id="message-form" class="flex items-center bg-white rounded-full shadow-sm px-4 py-2">
                    <input type="text" id="message-input" placeholder="Digite sua mensagem..." class="w-full bg-transparent border-none focus:ring-0 text-gray-700 placeholder-gray-500">
                </form>
            </div>
            <button id="send-button" class="ml-3 bg-[#00A859] w-12 h-12 rounded-full flex items-center justify-center text-white shadow-md hover:bg-[#008f4b] transition-colors flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </footer>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const messageForm = document.getElementById('message-form');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const quickRepliesContainer = document.getElementById('quick-replies');

        // --- NOVA L√ìGICA DE FLUXO DE CONVERSA ---
        const chatFlow = {
            'start': {
                message: "Ol√°! Tudo bem? üòä Sou seu assistente virtual da TIM. Estou aqui para te ajudar a encontrar o plano perfeito. Como posso te ajudar hoje?",
                replies: {
                    "Quero ver os planos": "ask_plan_focus",
                    "Fazer portabilidade": "portability_start",
                    "Quero comprar um chip": "buy_chip_start"
                },
                keywords: ['ol√°', 'oi', 'bom dia', 'boa tarde', 'boa noite', 'ola']
            },
            'ask_plan_focus': {
                message: "√ìtima escolha! Temos planos incr√≠veis para voc√™. Para te indicar a melhor op√ß√£o, me diga: o que √© mais importante em um plano?",
                replies: {
                    "Muita Internet üöÄ": "recommend_black",
                    "Redes Sociais Ilimitadas üì±": "recommend_controle",
                    "Custo-benef√≠cio üí∞": "recommend_controle_b",
                    "Voltar": "start"
                },
                keywords: ['planos', 'op√ß√µes', 'opcoes', 'internet', 'saber mais', 'mudar de plano', 'como funciona']
            },
            'recommend_black': {
                message: "Perfeito! Se o seu foco √© ter muita internet para navegar, jogar e assistir v√≠deos, o TIM Black √© a escolha certa. Voc√™ tem at√© 100GB, apps que n√£o gastam sua internet e assinatura de streaming inclusa. Quer ver os detalhes?",
                replies: {
                    "Sim, me mostre!": "show_black_details",
                    "Ver outros planos": "ask_plan_focus",
                    "N√£o, obrigado": "anything_else"
                }
            },
            'recommend_controle': {
                message: "Entendi! Para quem ama redes sociais, o TIM Controle √© perfeito. Voc√™ tem WhatsApp, Instagram, Facebook e X (Twitter) √† vontade, sem gastar sua internet, al√©m de uma √≥tima franquia para outros apps. Quer conhecer as ofertas?",
                replies: {
                    "Sim, quero conhecer!": "show_controle_details",
                    "Ver outros planos": "ask_plan_focus",
                    "N√£o, obrigado": "anything_else"
                }
            },
            'recommend_controle_b': {
                message: "√ìtimo! O TIM Controle √© o nosso campe√£o em custo-benef√≠cio. Voc√™ paga um valor fixo por m√™s e recebe um pacote completo com internet, liga√ß√µes e redes sociais ilimitadas. Quer ver os valores?",
                replies: {
                    "Sim, por favor!": "show_controle_details",
                    "Ver outras op√ß√µes": "ask_plan_focus",
                    "N√£o, obrigado": "anything_else"
                }
            },
            'show_black_details': {
                message: "O plano TIM Black 50GB, por exemplo, oferece: \n\n‚úÖ 50GB de internet + B√¥nus\n‚úÖ Assinatura da HBO Max inclusa\n‚úÖ WhatsApp, Instagram e mais apps ilimitados\n‚úÖ Liga√ß√µes e SMS ilimitados para todo Brasil\n\nUm pacote super completo! O que acha?",
                replies: {
                    "Gostei! Quero contratar": "closing_deal",
                    "Ver outros planos": "ask_plan_focus",
                    "Tenho uma d√∫vida": "human_attendant"
                }
            },
             'show_controle_details': {
                message: "O plano TIM Controle 25GB √© um sucesso! Ele inclui:\n\n‚úÖ 25GB de internet\n‚úÖ Redes Sociais ilimitadas (n√£o gastam sua internet)\n‚úÖ Liga√ß√µes e SMS ilimitados\n‚úÖ Tudo isso por um pre√ßo fixo e que cabe no bolso!\n\n√â uma √≥tima op√ß√£o, n√£o acha?",
                replies: {
                    "Adorei! Como contrato?": "closing_deal",
                    "Ver plano TIM Black": "recommend_black",
                    "Tenho uma d√∫vida": "human_attendant"
                }
            },
            'portability_start': {
                message: "Que legal que voc√™ quer vir pra TIM! üíô Trazer seu n√∫mero √© super f√°cil e voc√™ ainda ganha b√¥nus de internet. Vamos come√ßar? Primeiro, preciso que me informe seu DDD e n√∫mero atual para consulta.",
                replies: {
                    "Ver planos primeiro": "ask_plan_focus",
                    "N√£o quero informar agora": "portability_no_info"
                },
                keywords: ['portabilidade', 'trazer meu numero']
            },
            'portability_no_info': {
                message: "Sem problemas! Podemos ver os planos primeiro e, quando voc√™ se decidir, a gente retoma a portabilidade. O que acha?",
                replies: {
                    "Ok, vamos ver os planos": "ask_plan_focus",
                    "Voltar ao in√≠cio": "start"
                }
            },
            'buy_chip_start': {
                message: "Para comprar um novo chip da TIM √© muito simples! Voc√™ pode ir at√© uma de nossas lojas, bancas de jornal ou at√© mesmo pedir online com entrega em casa. Onde voc√™ prefere comprar?",
                replies: {
                    "Pedir online": "buy_chip_online",
                    "Encontrar loja f√≠sica": "buy_chip_store",
                    "Voltar": "start"
                },
                keywords: ['chip', 'comprar um chip']
            },
            'buy_chip_online': {
                message: "√ìtimo! Para pedir online, basta acessar o site da Loja TIM. L√° voc√™ escolhe seu plano e o chip chega no seu endere√ßo. √â r√°pido e seguro!",
                replies: {
                    "Obrigado!": "anything_else",
                    "Ver planos": "ask_plan_focus"
                }
            },
            'closing_deal': {
                message: "Maravilha! Para iniciar a contrata√ß√£o, vou te redirecionar para o nosso ambiente seguro de vendas. √â s√≥ clicar no link e seguir os passos. Obrigado por escolher a TIM! üöÄ",
                replies: {
                    "Ir para a contrata√ß√£o": "external_link", // A√ß√£o especial
                    "Voltar": "ask_plan_focus"
                }
            },
            'human_attendant': {
                message: "Entendo. No momento, nosso atendimento √© 100% digital por aqui para garantir mais agilidade. Pode me dizer qual √© a sua d√∫vida? Tenho certeza que consigo te ajudar! üòâ",
                replies: {
                    "Sobre os planos": "ask_plan_focus",
                    "Sobre portabilidade": "portability_start",
                    "√â outra coisa": "open_question"
                },
                keywords: ['atendente', 'falar com um atendente', 'humano', 'd√∫vida']
            },
            'open_question': {
                message: "Ok, pode digitar sua d√∫vida que farei o meu melhor para responder.",
                replies: {} // Sem bot√µes, for√ßa o usu√°rio a digitar
            },
            'cancel': {
                message: "Poxa, que pena que voc√™ est√° pensando em cancelar. üò• Nossos planos s√£o cheios de benef√≠cios. √Äs vezes, uma troca de plano j√° resolve. Que tal darmos uma olhada nas ofertas sem compromisso?",
                replies: {
                    "Ver outros planos": "ask_plan_focus",
                    "Quero cancelar mesmo": "cancel_info"
                },
                keywords: ['cancelar', 'cancelamento']
            },
            'cancel_info': {
                message: "Entendido. Para quest√µes de cancelamento, que envolvem dados pessoais, o ideal √© ligar para o *144 do seu TIM ou 1056 de qualquer telefone. A equipe respons√°vel poder√° te ajudar com seguran√ßa.",
                replies: {
                    "Obrigado pela informa√ß√£o": "anything_else",
                    "Voltar ao in√≠cio": "start"
                }
            },
            'anything_else': {
                message: "Disponha! Posso te ajudar com mais alguma coisa?",
                replies: {
                    "Sim, por favor": "start",
                    "N√£o, obrigado": "goodbye"
                }
            },
            'goodbye': {
                message: "Certo! Se precisar de algo mais, √© s√≥ chamar. A TIM agradece seu contato! Tenha um √≥timo dia! üëã",
                replies: {}
            },
            'fallback': {
                message: "Desculpe, n√£o entendi muito bem. Que tal tentarmos por um desses caminhos?",
                replies: {
                    "Ver planos": "ask_plan_focus",
                    "Fazer portabilidade": "portability_start",
                    "Falar com atendente": "human_attendant"
                },
                 keywords: []
            }
        };
        
        // --- FUN√á√ïES DO CHATBOT ---

        function addMessage(text, sender) {
            const bubble = document.createElement('div');
            const messageClass = sender === 'user' ? 'message-sent bg-[#dcf8c6] self-end' : 'message-received bg-white self-start';
            bubble.className = `message-bubble relative max-w-xs lg:max-w-md p-3 rounded-lg shadow message-fade-in ${messageClass}`;
            bubble.innerHTML = text.replace(/\n/g, '<br>'); // Suporta quebra de linha
            chatMessages.appendChild(bubble);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingBubble = document.createElement('div');
            typingBubble.id = 'typing-indicator';
            typingBubble.className = 'message-received bg-white self-start p-3 rounded-lg shadow flex items-center space-x-1';
            typingBubble.innerHTML = `<div class="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div><div class="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div><div class="typing-dot w-2 h-2 bg-gray-400 rounded-full"></div>`;
            chatMessages.appendChild(typingBubble);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            document.getElementById('typing-indicator')?.remove();
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showQuickReplies(replies) {
            quickRepliesContainer.innerHTML = '';
            if (!replies || Object.keys(replies).length === 0) {
                quickRepliesContainer.classList.add('!p-0'); // Esconde o padding se n√£o tiver bot√µes
                return;
            }
            quickRepliesContainer.classList.remove('!p-0');

            for (const text in replies) {
                const button = document.createElement('button');
                button.innerHTML = text; // Usando innerHTML para renderizar emojis
                button.className = "bg-white border border-[#00A859] text-[#00A859] px-4 py-2 rounded-full text-sm font-medium hover:bg-[#e6f7ef] transition-colors";
                button.dataset.next = replies[text];
                button.onclick = () => handleQuickReplyClick(button.dataset.next, text);
                quickRepliesContainer.appendChild(button);
            }
        }

        function handleQuickReplyClick(nextNodeKey, text) {
            if (nextNodeKey === 'external_link') {
                // A√ß√£o especial para links externos
                window.open('https://www.tim.com.br/', '_blank');
                addMessage("Estou te redirecionando. Se a nova p√°gina n√£o abrir, por favor, clique aqui: <a href='https://www.tim.com.br/' target='_blank' class='text-blue-600 underline'>Loja TIM</a>", 'bot');
                return;
            }

            addMessage(text, 'user');
            quickRepliesContainer.innerHTML = '';
            quickRepliesContainer.classList.add('!p-0');
            
            renderNode(nextNodeKey);
        }
        
        function renderNode(nodeKey) {
            const node = chatFlow[nodeKey] || chatFlow['fallback'];
            
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(node.message, 'bot');
                showQuickReplies(node.replies);
            }, 1000 + Math.random() * 500);
        }

        function handleUserMessage(event) {
            event.preventDefault();
            const userInput = messageInput.value.trim();
            if (!userInput) return;

            addMessage(userInput, 'user');
            messageInput.value = '';
            quickRepliesContainer.innerHTML = '';
            quickRepliesContainer.classList.add('!p-0');
            
            const lowerCaseInput = userInput.toLowerCase();
            let matchedNodeKey = 'fallback';

            // Procura por uma correspond√™ncia de palavra-chave
            for (const key in chatFlow) {
                if (chatFlow[key].keywords?.some(kw => lowerCaseInput.includes(kw))) {
                    matchedNodeKey = key;
                    break;
                }
            }
            
            renderNode(matchedNodeKey);
        }

        messageForm.addEventListener('submit', handleUserMessage);
        sendButton.addEventListener('click', handleUserMessage);

        window.onload = () => renderNode('start');

    </script>
</body>
</html>
